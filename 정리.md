# 기본 문법
## JPQL VS QueryDSL

```kt
    @Test
    fun startJPQL() {
        // member1을 찾아라
        val member = entityManager
            .createQuery("select m from Member m where m.username = :username", Member::class.java)
            .setParameter("username", "member1")
            .singleResult

        assertThat(member.username).isEqualTo("member1")
    }
```
* `createQuery()` 시, 단순 SQL 문자열이기 때문에 런타임이 되어서야 문제를 알 수 있다.   
* 코드 문맥 자체가 쿼리/자바 따로 나뉘어져 있어 가독성이 다소 떨어진다.  

```kt
    @Test
    fun startQuerydsl() {
        // member1을 찾아라
        val jpaQueryFactory = JPAQueryFactory(entityManager)
        val member = jpaQueryFactory.select(member)
            .from(member)
            .where(member.username.eq("member1"))
            .fetchOne() ?: throw IllegalArgumentException()

        assertThat(member.username).isEqualTo("member1")
    }
```
* QType 이라는 자바 클래스를 만들어 실행하기에, 컴파일 타임에서 문제를 알 수 있다.  
* 정적인 문자열이 아닌, 동적 쿼리를 생성해주고 실행한다.  
* 불필요한 바인딩 처리를 하지 않아도 된다.   
* 실제 자바 코드를 사용하는 것이기에 쿼리를 따로 메서드로 만들어서 활용 가능하다.(위는 문자열을 바꾼거고)  

## QType 생성 

```kt
        val qMember = QMember("m")
```
* 새로운 큐타입을 만드는 경우(같은 테이블을 조인할 때 사용)  

```kt
        val staticQMember = QMember.member
```
* static으로 만들어진 기본 큐타입(주로 사용) 

## 검색 조건 쿼리 
### AND
```kt
    @Test
    fun search() {
        val jpaQueryFactory = JPAQueryFactory(entityManager)
        val member = jpaQueryFactory.selectFrom(member)
            .where(member.username.eq("member1").and(member.age.eq(10)))
            .fetchOne() ?: throw IllegalArgumentException()
    }
```
```kt
    @Test
    fun search() {
        val jpaQueryFactory = JPAQueryFactory(entityManager)
        val member = jpaQueryFactory.selectFrom(member)
            .where(member.username.eq("member1"), member.age.eq(10))
            .fetchOne() ?: throw IllegalArgumentException()
    }
```
참고로 `and()`의 경우 가변인자로 넘김으로써 동작시킬수 있다(가독성 좋다)  

### OR 
```kt
    @Test
    fun search() {
        val jpaQueryFactory = JPAQueryFactory(entityManager)
        val member = jpaQueryFactory.selectFrom(member)
            .where(member.username.eq("member1").or(member.age.eq(10)))
            .fetchOne() ?: throw IllegalArgumentException()
    }
```

### 문법 
```kt
member.username.eq("member1") // username = 'member1'
member.username.ne("member1") //username != 'member1'
member.username.eq("member1").not() // username != 'member1'
member.username.isNotNull() //이름이 is not null
member.age.in(10, 20) // age in (10,20)
member.age.notIn(10, 20) // age not in (10, 20)
member.age.between(10,30) //between 10, 30
member.age.goe(30) // age >= 30
member.age.gt(30) // age > 30
member.age.loe(30) // age <= 30
member.age.lt(30) // age < 30
member.username.like("member%") //like 검색
member.username.contains("member") // like ‘%member%’ 검색
member.username.startsWith("member") //like ‘member%’ 검색
```

## 

```kt
//List
fetch: List<Member>  = queryFactory
 .selectFrom(member)
 .fetch();
 
//단 건
val findMember1: Member = queryFactory
 .selectFrom(member)
 .fetchOne();

//처음 한 건 조회
val findMember2: Member = queryFactory
 .selectFrom(member)
 .fetchFirst();

//페이징에서 사용
val results: QueryResults<Member> = queryFactory
 .selectFrom(member)
 .fetchResults();

//count 쿼리로 변경
val count : long  = queryFactory
 .selectFrom(member)
 .fetchCount();
```

## 정렬 

```kt
/**
 * 회원 정렬 순서
 * 1. 회원 나이 내림차순(desc)
 * 2. 회원 이름 올림차순(asc)
 * 단 2에서 회원 이름이 없으면 마지막에 출력(nulls last)
 */
@Test
fun sort() {
    em.persist(Member(null, 100));
    em.persist(Member("member5", 100));
    em.persist(Member("member6", 100));
    
    List<Member> result = queryFactory
       .selectFrom(member)
       .where(member.age.eq(100))
       .orderBy(member.age.desc(), member.username.asc().nullsLast())
       .fetch();
 
    val member5 = result.get(0);
    val member6 = result.get(1);
    val memberNull = result.get(2);
    
    assertThat(member5.getUsername()).isEqualTo("member5");
    assertThat(member6.getUsername()).isEqualTo("member6");
    assertThat(memberNull.getUsername()).isNull();
}
```
